<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>後台管理系統</title>

<!-- Google Fonts & Material Icons -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: #f5f5f5;
    margin: 0;
  }

  /* ---------- Top App Bar ---------- */
  .appbar {
    background: #1976d2;
    color: white;
    padding: 16px;
    font-size: 20px;
    font-weight: 600;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  /* ---------- Search Bar ---------- */
  .search-box {
    margin: 20px;
    display: flex;
    background: white;
    padding: 10px 14px;
    border-radius: 14px;
    gap: 10px;
    align-items: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }

  .search-box input {
    flex: 1;
    border: none;
    font-size: 16px;
    outline: none;
  }

  /* ---------- Table ---------- */
  .table-box {
    margin: 20px;
    background: white;
    border-radius: 14px;
    padding: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.15);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 5px;
  }

  th, td {
    padding: 14px 10px;
    font-size: 15px;
    border-bottom: 1px solid #eee;
  }

  th {
    font-weight: 600;
    color: #444;
  }

  /* ---------- Status Tag ---------- */
  .tag {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    display: inline-block;
  }
  .tag.new { background: #e3f2fd; color: #1976d2; }
  .tag.confirmed { background: #e8f5e9; color: #2e7d32; }
  .tag.cancelled { background: #ffebee; color: #c62828; }

  .btn-icon {
    border: none;
    background: transparent;
    cursor: pointer;
  }

  .btn-icon .material-icons {
    font-size: 22px;
    color: #555;
  }

  .btn-icon:hover .material-icons {
    color: #1976d2;
  }

  /* ---------- Modal Background ---------- */
  .modal-bg {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    display: none;
    justify-content: center;
    align-items: center;
  }

  /* ---------- Modal ---------- */
  .modal-box {
    width: 92%;
    max-width: 430px;
    background: white;
    padding: 22px;
    border-radius: 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.25);
    animation: fadeIn 0.2s ease;
  }

  @keyframes fadeIn {
    from { transform: translateY(10px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .modal-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .form-row {
    margin-bottom: 12px;
  }

  .form-row label {
    font-size: 14px;
    color: #555;
    display: block;
    margin-bottom: 6px;
  }

  .form-row input, .form-row select {
    width: 100%;
    padding: 10px 12px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 10px;
    outline: none;
  }

  .modal-btns {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 20px;
  }

  .btn {
    padding: 10px 16px;
    border-radius: 10px;
    cursor: pointer;
    border: none;
    font-weight: 600;
  }

  .btn.cancel { background: #eee; }
  .btn.save { background: #1976d2; color: white; }

</style>
</head>

<body>

<!-- Top Bar -->
<div class="appbar">管理後台</div>

<!-- Search -->
<div class="search-box">
  <span class="material-icons">search</span>
  <input type="text" id="searchInput" placeholder="搜尋姓名 / 手機 / 房型...">
</div>

<!-- Booking Table -->
<div class="table-box">
  <table>
    <thead>
  <tr>
    <th>姓名</th>
    <th>電話</th>
    <th>Email</th>
    <th>房型</th>
    <th>入住</th>
    <th>退房</th>
    <th>晚數</th>
    <th>大人</th>
    <th>小孩</th>
    <th>寵物</th>
    <th>備註</th>
    <th>狀態</th>
    <th style="width:80px"></th>
  </tr>
</thead>
<tbody id="bookingTable"></tbody>

  </table>
</div>

<!-- =============== EDIT MODAL =============== -->
<div id="editModalBg" class="modal-bg">
  <div class="modal-box">
    <div class="modal-title">編輯訂單</div>

    <div class="form-row"><label>姓名</label><input id="editName"></div>
    <div class="form-row"><label>電話</label><input id="editPhone"></div>
    <div class="form-row"><label>Email</label><input id="editEmail"></div>
    <div class="form-row"><label>房型</label><input id="editRoom"></div>

    <div class="form-row"><label>入住</label><input type="date" id="editCheckin"></div>
    <div class="form-row"><label>退房</label><input type="date" id="editCheckout"></div>
    <div class="form-row"><label>晚數</label><input type="number" id="editNights"></div>

    <div class="form-row"><label>大人</label><input type="number" id="editAdult"></div>
    <div class="form-row"><label>小孩</label><input type="number" id="editChild"></div>
    <div class="form-row"><label>寵物</label><input id="editPet"></div>

    <div class="form-row"><label>備註</label><input id="editNote"></div>

    <div class="form-row">
      <label>訂單狀態</label>
      <select id="editStatus">
        <option value="new">新訂單</option>
        <option value="confirmed">已確認</option>
        <option value="cancelled">已取消</option>
      </select>
    </div>

    <div class="modal-btns">
      <button class="btn cancel" onclick="closeEdit()">取消</button>
      <button class="btn save" onclick="saveEdit()">儲存</button>
    </div>
  </div>
</div>


<script>

/* ❶ 連接 Google Sheet API */
const API_URL = "https://script.google.com/macros/s/AKfycbyHOU7VmPD80BXHq7SjOD7NthUYHKI1EjtEA_62euGDKi_Jwbzjwu6TUxGKGPR7u3i5/exec";

let bookings = [];
let editTarget = null;

/* ❷ 讀取 Google Sheet */
async function loadData(){
  const res = await fetch(API_URL);
  bookings = await res.json();
  renderTable();
}


/* ---------- Render Table ---------- */
function renderTable() {
  const tbody = document.getElementById("bookingTable");
  tbody.innerHTML = "";

  bookings.forEach(b=>{
    tbody.innerHTML += `
    <tr>
      <td>${b.name}</td>
      <td>${b.phone}</td>
      <td>${b.email || "-"}</td>
      <td>${b.room}</td>
      <td>${b.checkin}</td>
      <td>${b.checkout}</td>
      <td>${b.nights}</td>
      <td>${b.adult}</td>
      <td>${b.child}</td>
      <td>${b.pet}</td>
      <td>${b.note || "-"}</td>

      <td><span class="tag ${b.status}">${statusText(b.status)}</span></td>

      <!-- 編輯/刪除 保留 -->
      <td>
        <button class="btn-icon" onclick="openEdit('${b.id}')"><span class="material-icons">edit</span></button>
        <button class="btn-icon" onclick="openDelete('${b.id}')"><span class="material-icons">delete</span></button>
      </td>
    </tr>`;
  });
}

function statusText(code) {
  return {
    new:"新訂單",
    confirmed:"已確認",
    cancelled:"已取消"
  }[code] || "-";
}

/* ---------- EDIT MODAL FUNCTIONS ---------- */
function openEdit(id){
  editTarget = bookings.find(x=>x.id===id);

  editName.value   = editTarget.name;
  editPhone.value  = editTarget.phone;
  editEmail.value  = editTarget.email;
  editRoom.value   = editTarget.room;
  editCheckin.value= editTarget.checkin;
  editCheckout.value=editTarget.checkout;

  editNights.value = editTarget.nights;
  editAdult.value  = editTarget.adult;
  editChild.value  = editTarget.child;
  editPet.value    = editTarget.pet;
  editNote.value   = editTarget.note;

  editStatus.value = editTarget.status;
  document.getElementById("editModalBg").style.display="flex";
}

function closeEdit() {
  document.getElementById("editModalBg").style.display = "none";
}

/* 儲存變更+即時刷新畫面 */
function saveEdit(){
  editTarget.name   = editName.value;
  editTarget.phone  = editPhone.value;
  editTarget.email  = editEmail.value;
  editTarget.room   = editRoom.value;
  editTarget.checkin= editCheckin.value;
  editTarget.checkout=editCheckout.value;

  editTarget.nights= editNights.value;
  editTarget.adult = editAdult.value;
  editTarget.child = editChild.value;
  editTarget.pet   = editPet.value;
  editTarget.note  = editNote.value;

  editTarget.status= editStatus.value;

  closeEdit();
  renderTable();
}

/* ---------- Initialize ---------- */
renderTable();

</script>

</body>
</html>
