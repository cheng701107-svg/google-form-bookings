<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>填寫預約資料</title>

<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: #f5f5f5;
    padding: 20px;
  }

  h2 {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 18px;
  }

  .info-box {
    background: white;
    padding: 18px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-bottom: 25px;
  }

  .info-box div {
    margin-bottom: 8px;
    font-size: 16px;
  }

  .field {
    margin-bottom: 18px;
  }

  label {
    display: block;
    margin-bottom: 6px;
    font-size: 15px;
    font-weight: 600;
  }

  input, textarea, select {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: 1px solid #ccc;
    font-size: 16px;
    background: white;
  }

  textarea {
    height: 90px;
  }

  .btn {
    width: 100%;
    background: #007bff;
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    margin-top: 25px;
  }

  .btn:active { opacity: 0.85; }
</style>
</head>

<body>

<h2>填寫預約資料</h2>

<!-- 訂單摘要 -->
<div class="info-box">
  <div>房型：<span id="roomTitle"></span></div>
  <div>入住：<span id="checkin"></span></div>
  <div>退房：<span id="checkout"></span></div>
  <div>晚數：<span id="nights"></span></div>
  <div>總金額：<span id="total"></span></div>
</div>

<!-- 表單 -->
<form id="bookingForm">

  <div class="field">
    <label>姓名（必填）</label>
    <input type="text" id="name" required>
  </div>

  <div class="field">
    <label>手機號碼（必填）</label>
    <input type="tel" id="phone" required placeholder="0912345678">
  </div>

  <div class="field">
    <label>Email（選填）</label>
    <input type="email" id="email">
  </div>

  <div class="field">
    <label>大人人數</label>
    <input type="number" id="adult" min="1" value="1">
  </div>

  <div class="field">
    <label>小孩人數</label>
    <input type="number" id="child" min="0" value="0">
  </div>

  <div class="field">
    <label>是否攜帶寵物</label>
    <select id="pet">
      <option value="無">無</option>
      <option value="有">有</option>
    </select>
  </div>

  <div class="field">
    <label>備註</label>
    <textarea id="note"></textarea>
  </div>

</form>

<div class="btn" id="submitBtn">送出預約</div>

<script>
/* 取得 URL 參數 */
const params = new URLSearchParams(location.search);
const roomId = params.get("roomId");
const checkIn = params.get("date");
const nights = Number(params.get("nights"));

/* 計算退房日期 */
let checkout = "-";
if (checkIn && nights) {
  const d = new Date(checkIn);
  d.setDate(d.getDate() + nights);
  checkout = d.toISOString().split("T")[0];
}

document.getElementById("checkin").innerText = checkIn ?? "-";
document.getElementById("checkout").innerText = checkout ?? "-";
document.getElementById("nights").innerText = nights ?? "-";

/* 讀取房型資料並計算金額 */
async function loadRoom() {
  const res = await fetch("data/rooms.json");
  const rooms = await res.json();
  const room = rooms.find(r => r.id === roomId);

  document.getElementById("roomTitle").innerText = room.title;

  // 計算總金額
  let total = 0;
  const startDate = new Date(checkIn);

  for (let i = 0; i < nights; i++) {
    const d = new Date(startDate);
    d.setDate(startDate.getDate() + i);

    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const dd = String(d.getDate()).padStart(2, "0");
    const key = `${y}-${m}-${dd}`;

    if (room.specialPrice && room.specialPrice[key]) {
      total += room.specialPrice[key];
      continue;
    }

    const w = d.getDay();
    if (w === 0 || w === 6) {
      total += room.priceWeekend;
    } else {
      total += room.priceWeekday;
    }
  }

  document.getElementById("total").innerText = "NT$ " + total.toLocaleString();
}

loadRoom();

/* 送出（這裡你可改成串 Google Sheet / GAS / Make） */
document.getElementById("submitBtn").onclick = () => {
  alert("預約資料已送出！（此為示範，尚未串接後端）");
};
</script>

</body>
</html>
