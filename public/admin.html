<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>後台管理系統</title>

<!-- Google Fonts & Material Icons -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: #f5f5f5;
    margin: 0;
  }

  /* ---------- Top App Bar ---------- */
  .appbar {
    background: #1976d2;
    color: white;
    padding: 16px;
    font-size: 20px;
    font-weight: 600;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  /* ---------- Search Bar ---------- */
  .search-box {
    margin: 20px;
    display: flex;
    background: white;
    padding: 10px 14px;
    border-radius: 14px;
    gap: 10px;
    align-items: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }

  .search-box input {
    flex: 1;
    border: none;
    font-size: 16px;
    outline: none;
  }

  /* ---------- Table ---------- */
  .table-box {
    margin: 20px;
    background: white;
    border-radius: 14px;
    padding: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.15);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 5px;
  }

  th, td {
    padding: 14px 10px;
    font-size: 15px;
    border-bottom: 1px solid #eee;
  }

  th {
    font-weight: 600;
    color: #444;
  }

  /* ---------- Status Tag ---------- */
  .tag {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    display: inline-block;
  }
  .tag.new { background: #e3f2fd; color: #1976d2; }
  .tag.confirmed { background: #e8f5e9; color: #2e7d32; }
  .tag.cancelled { background: #ffebee; color: #c62828; }

  .btn-icon {
    border: none;
    background: transparent;
    cursor: pointer;
  }

  .btn-icon .material-icons {
    font-size: 22px;
    color: #555;
  }

  .btn-icon:hover .material-icons {
    color: #1976d2;
  }

  /* ---------- Modal Background ---------- */
  .modal-bg {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.35);
    display: none;
    justify-content: center;
    align-items: center;
  }

  /* ---------- Modal ---------- */
  .modal-box {
    width: 92%;
    max-width: 460px;
    background: white;
    padding: 22px;
    border-radius: 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.25);
    animation: fadeIn 0.2s ease;
    max-height: 90vh;
    overflow-y: auto;
  }

  @keyframes fadeIn {
    from { transform: translateY(10px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .modal-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .form-row {
    margin-bottom: 12px;
  }

  .form-row label {
    font-size: 14px;
    color: #555;
    display: block;
    margin-bottom: 6px;
  }

  .form-row input, .form-row select, .form-row textarea {
    width: 100%;
    padding: 10px 12px;
    font-size: 15px;
    border: 1px solid #ccc;
    border-radius: 10px;
    outline: none;
  }

  textarea {
    resize: vertical;
    min-height: 70px;
  }

  .modal-btns {
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    margin-top: 20px;
  }

  .btn {
    padding: 10px 16px;
    border-radius: 10px;
    cursor: pointer;
    border: none;
    font-weight: 600;
  }

  .btn.cancel { background: #eee; }
  .btn.save { background: #1976d2; color: white; }

</style>
</head>

<body>

<!-- Top Bar -->
<div class="appbar">管理後台</div>

<!-- Search -->
<div class="search-box">
  <span class="material-icons">search</span>
  <input type="text" id="searchInput" placeholder="搜尋姓名 / 手機 / 房型...">
</div>

<!-- Booking Table -->
<div class="table-box">
  <table>
    <thead>
      <tr>
        <th>姓名</th>
        <th>房型</th>
        <th>入住</th>
        <th>退房</th>
        <th>付款</th>
        <th>狀態</th>
        <th></th>
      </tr>
    </thead>
    <tbody id="bookingTable"></tbody>
  </table>
</div>

<!-- =============== EDIT MODAL =============== -->
<div id="editModalBg" class="modal-bg">
  <div class="modal-box">
    
    <div class="modal-title">編輯訂單</div>

    <!-- 訂單編號 & 建立時間 -->
    <div class="form-row">
      <label>訂單編號（不可修改）</label>
      <input type="text" id="editOrderId" readonly>
    </div>

    <div class="form-row">
      <label>建立時間（不可修改）</label>
      <input type="text" id="editCreatedAt" readonly>
    </div>

    <!-- 基本資料 -->
    <div class="form-row">
      <label>姓名</label>
      <input type="text" id="editName">
    </div>

    <div class="form-row">
      <label>手機</label>
      <input type="text" id="editPhone">
    </div>

    <div class="form-row">
      <label>房型</label>
      <input type="text" id="editRoom">
    </div>

    <div class="form-row">
      <label>入住日期</label>
      <input type="date" id="editCheckin">
    </div>

    <div class="form-row">
      <label>退房日期</label>
      <input type="date" id="editCheckout">
    </div>

    <!-- 訂單狀態 -->
    <div class="form-row">
      <label>訂單狀態</label>
      <select id="editOrderStatus">
        <option value="active">成立</option>
        <option value="cancelled">已取消</option>
        <option value="checkedin">已入住</option>
        <option value="completed">已完成</option>
      </select>
    </div>

    <!-- 付款資訊 -->
    <div class="form-row">
      <label>付款方式</label>
      <select id="editPayMethod">
        <option value="none">尚未選擇</option>
        <option value="bank">匯款</option>
        <option value="linepay">LINE Pay</option>
        <option value="card">信用卡</option>
      </select>
    </div>

    <div class="form-row">
      <label>匯款後五碼（僅匯款需填）</label>
      <input type="text" id="editBankCode">
    </div>

    <div class="form-row">
      <label>訂金金額</label>
      <input type="number" id="editDeposit">
    </div>

    <div class="form-row">
      <label>尾款金額（自動計算）</label>
      <input type="number" id="editRemaining" readonly>
    </div>

    <div class="form-row">
      <label>付款狀態</label>
      <select id="editPayStatus">
        <option value="unpaid">未付款</option>
        <option value="deposit">已付訂</option>
        <option value="paid">已付全額</option>
      </select>
    </div>

    <!-- 註記 & 備註 -->
    <div class="form-row">
      <label>MARK（內部註記）</label>
      <textarea id="editMark"></textarea>
    </div>

    <div class="form-row">
      <label>業者備註</label>
      <textarea id="editNote"></textarea>
    </div>

    <div class="modal-btns">
      <button class="btn cancel" onclick="closeEdit()">取消</button>
      <button class="btn save" onclick="saveEdit()">儲存</button>
    </div>

  </div>
</div>

<script>

//
// 假資料（等你說要接 Google Sheet，我再幫你串）
//
let bookings = [
  {
    id:"B001",
    createdAt:"2025-01-15 10:23",
    name:"王小明",
    phone:"0912000111",
    room:"A館包棟",
    checkin:"2025-12-04",
    checkout:"2025-12-05",
    status:"active",       // 成立
    payMethod:"bank",
    bankCode:"12345",
    deposit:3000,
    remaining:18000,
    payStatus:"deposit",   // 已付訂
    mark:"常客",
    note:"指定靠窗房"
  }
];

let editTarget = null;

/* ---------- Render Table ---------- */
function renderTable() {
  const tbody = document.getElementById("bookingTable");
  tbody.innerHTML = "";

  bookings.forEach(b => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>${b.name}</td>
      <td>${b.room}</td>
      <td>${b.checkin}</td>
      <td>${b.checkout}</td>
      <td>${payStatusText(b.payStatus)}</td>
      <td>${orderStatusText(b.status)}</td>

      <td>
        <button class="btn-icon" onclick="openEdit('${b.id}')">
          <span class="material-icons">edit</span>
        </button>

        <button class="btn-icon" onclick="openDelete('${b.id}')">
          <span class="material-icons">delete</span>
        </button>
      </td>
    `;

    tbody.appendChild(row);
  });
}

function payStatusText(code) {
  return {
    unpaid:"未付款",
    deposit:"已付訂",
    paid:"已付全額"
  }[code] || "-";
}

function orderStatusText(code) {
  return {
    active:"成立",
    cancelled:"已取消",
    checkedin:"已入住",
    completed:"已完成"
  }[code] || "-";
}

/* ---------- EDIT MODAL FUNCTIONS ---------- */
function openEdit(id) {
  editTarget = bookings.find(b => b.id === id);

  // 基本資料
  document.getElementById("editOrderId").value = editTarget.id;
  document.getElementById("editCreatedAt").value = editTarget.createdAt;
  document.getElementById("editName").value = editTarget.name;
  document.getElementById("editPhone").value = editTarget.phone;
  document.getElementById("editRoom").value = editTarget.room;
  document.getElementById("editCheckin").value = editTarget.checkin;
  document.getElementById("editCheckout").value = editTarget.checkout;

  // 訂單狀態
  document.getElementById("editOrderStatus").value = editTarget.status;

  // 付款資訊
  document.getElementById("editPayMethod").value = editTarget.payMethod;
  document.getElementById("editBankCode").value = editTarget.bankCode;
  document.getElementById("editDeposit").value = editTarget.deposit;
  document.getElementById("editRemaining").value = editTarget.remaining;
  document.getElementById("editPayStatus").value = editTarget.payStatus;

  // 備註/註記
  document.getElementById("editMark").value = editTarget.mark;
  document.getElementById("editNote").value = editTarget.note;

  document.getElementById("editModalBg").style.display = "flex";
}

function closeEdit() {
  document.getElementById("editModalBg").style.display = "none";
}

function saveEdit() {
  editTarget.name = document.getElementById("editName").value;
  editTarget.phone = document.getElementById("editPhone").value;
  editTarget.room = document.getElementById("editRoom").value;
  editTarget.checkin = document.getElementById("editCheckin").value;
  editTarget.checkout = document.getElementById("editCheckout").value;

  editTarget.status = document.getElementById("editOrderStatus").value;

  editTarget.payMethod = document.getElementById("editPayMethod").value;
  editTarget.bankCode = document.getElementById("editBankCode").value;
  editTarget.deposit = Number(document.getElementById("editDeposit").value);
  editTarget.remaining = editTarget.remaining;
  editTarget.payStatus = document.getElementById("editPayStatus").value;

  editTarget.mark = document.getElementById("editMark").value;
  editTarget.note = document.getElementById("editNote").value;

  closeEdit();
  renderTable();
}

/* ---------- Initialize ---------- */
renderTable();

</script>

</body>
</html>
