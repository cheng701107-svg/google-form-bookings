<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>  
<link rel="stylesheet" href="style.css"> 
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>å¡«å¯«é ç´„è³‡æ–™</title>

<style>
  body{
  font-family:"Noto Sans TC",sans-serif;
  background:#f7f7f7;
  margin:0;
}

/* === PC / å¹³æ¿ === */
.page-container{
  width:100%;
  max-width:660px;
  margin:auto;
  padding:25px 16px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.info-box,
form,
.btn{
  width:100%;
  max-width:660px;
  margin:0 auto 24px;
}

/* =========================
   ğŸ“± æ‰‹æ©Ÿæœ€ä½³ç€è¦½å¯¬åº¦å„ªåŒ–
========================= */
@media (max-width:768px) {
  .info-box,
  form,
  .btn {
    max-width:92%;      /* â­ æ‰‹æ©Ÿæœ€ä½³å¯¬åº¦ï¼ˆæ¨è–¦ï¼‰ */
    margin-left:auto;
    margin-right:auto;
  }

  input, textarea, select {
    font-size:16px;
    padding:14px;
  }
}

@media (max-width:480px) {
  .info-box,
  form,
  .btn {
    max-width:94%;      /* â­ æ›´å°è¢å¹•å¾®æ”¾å¤§ï¼Œä»ç½®ä¸­ */
  }

  .btn {
    font-size:18px;     /* æ‰‹æ„Ÿæ›´å¥½ */
    padding:16px;
  }
}


/* ===== è¨‚å–®æ‘˜è¦ ===== */
.info-box{
  background:#fff;
  border-radius:14px;
  padding:22px;
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
  font-size:17px;
  line-height:1.7;
}

/* ===== è¡¨å–® ===== */
form{
  background:#fff;
  padding:22px 22px 30px;
  border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
}

.field{margin-bottom:18px;}
label{font-size:15px;font-weight:700;margin-bottom:6px;display:block;}

input,textarea,select{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:10px;
  border:1px solid #ccc;
  transition:.2s;
  box-sizing:border-box;
}
input:focus,textarea:focus,select:focus{
  border-color:#1a73e8;
  box-shadow:0 0 0 3px rgba(26,115,232,.2);
}
textarea{height:95px}

/* ===== æŒ‰éˆ• ===== */
.btn{
  background:#1a73e8;
  color:white;
  font-size:20px;
  font-weight:800;
  padding:18px;
  border-radius:12px;
  text-align:center;
  cursor:pointer;
  margin-top:10px;
}
.btn:hover{opacity:.86;}
</style>
</head>

<body>

<div class="page-container">

<h2>å¡«å¯«é ç´„è³‡æ–™</h2>

<!-- è¨‚å–®æ‘˜è¦ -->
<div class="info-box">
  <div>æˆ¿å‹ï¼š<span id="roomTitle">â€”</span></div>
  <div>å…¥ä½ï¼š<span id="checkin">â€”</span></div>
  <div>é€€æˆ¿ï¼š<span id="checkout">â€”</span></div>
  <div>æ™šæ•¸ï¼š<span id="nights">â€”</span></div>
  <div style="margin-top:6px;font-size:18px">
    ç¸½é‡‘é¡ï¼š<b style="color:#0B7D2B;font-size:20px"><span id="total"></span></b>
  </div>
</div>

<!-- è¡¨å–® -->
<form id="bookingForm">
  <div class="field">
    <label>å§“åï¼ˆå¿…å¡«ï¼‰</label>
    <input type="text" id="name" required>
  </div>

  <div class="field">
    <label>æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆå¿…å¡«ï¼‰</label>
    <input type="tel" id="phone" required placeholder="0912345678">
  </div>

  <div class="field">
    <label>Emailï¼ˆé¸å¡«ï¼‰</label>
    <input type="email" id="email">
  </div>

  <div class="field">
    <label>å¤§äººäººæ•¸</label>
    <input type="number" id="adult" min="1" value="1">
  </div>

  <div class="field">
    <label>å°å­©äººæ•¸</label>
    <input type="number" id="child" min="0" value="0">
  </div>

  <div class="field">
    <label>æ˜¯å¦æ”œå¸¶å¯µç‰©</label>
    <select id="pet">
      <option value="ç„¡">ç„¡</option>
      <option value="æœ‰">æœ‰</option>
    </select>
  </div>

  <div class="field">
    <label>å‚™è¨»</label>
    <textarea id="note"></textarea>
  </div>
</form>

<!-- æŒ‰éˆ• -->
<div class="btn" id="submitBtn">é€å‡ºé ç´„ âœ</div>

</div><!--container END-->

<script>
/*** å–å¾— URL åƒæ•¸ ***/
const params = new URLSearchParams(location.search);
const roomId = params.get("roomId");
const checkIn = params.get("date");
const nightsNum = Number(params.get("nights"));

/*** è¨ˆç®—é€€æˆ¿ ***/
let checkoutStr = "-";
if (checkIn && nightsNum) {
  const d = new Date(checkIn);
  d.setDate(d.getDate() + nightsNum);
  checkoutStr = d.toISOString().split("T")[0];
}

document.getElementById("checkin").innerText  = checkIn   ?? "-";
document.getElementById("checkout").innerText = checkoutStr ?? "-";
document.getElementById("nights").innerText   = nightsNum ?? "-";

/*** æˆ¿å‹ + é‡‘é¡è¨ˆç®— ***/
async function loadRoom(){
  const res   = await fetch("data/rooms.json");
  const rooms = await res.json();
  const room  = rooms.find(r => r.id === roomId);

  document.getElementById("roomTitle").innerText = room.title;

  let total = 0, sd = new Date(checkIn);
  for(let i=0;i<nightsNum;i++){
    const d = new Date(sd);
    d.setDate(sd.getDate() + i);
    const k = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    if(room.specialPrice && room.specialPrice[k]){ total += room.specialPrice[k]; continue; }
    total += ([0,6].includes(d.getDay()) ? room.priceWeekend : room.priceWeekday);
  }
  document.getElementById("total").innerText = "NT$ " + total.toLocaleString();
}
loadRoom();

/*** é€™è£¡æ”¹æˆã€Œç¢ºå¯¦æŠ“åˆ° DOM å…ƒç´ ã€ ***/
const nameInput   = document.getElementById("name");
const phoneInput  = document.getElementById("phone");
const emailInput  = document.getElementById("email");
const adultInput  = document.getElementById("adult");
const childInput  = document.getElementById("child");
const petSelect   = document.getElementById("pet");
const noteTextarea= document.getElementById("note");

const roomTitleEl = document.getElementById("roomTitle");
const checkinEl   = document.getElementById("checkin");
const checkoutEl  = document.getElementById("checkout");
const nightsEl    = document.getElementById("nights");

const GAS_URL = "https://script.google.com/macros/s/AKfycbyHOU7VmPD80BXHq7SjOD7NthUYHKI1EjtEA_62euGDKi_Jwbzjwu6TUxGKGPR7u3i5/exec";

/*** ç”¨ FormData é€ï¼ˆé¿å… CORS å•é¡Œï¼‰ ***/
document.getElementById("submitBtn").onclick = async () => {
  const fd = new FormData();
  fd.append("name",     nameInput.value);
  fd.append("phone",    phoneInput.value);
  fd.append("email",    emailInput.value);
  fd.append("room",     roomTitleEl.innerText);
  fd.append("checkin",  checkinEl.innerText);
  fd.append("checkout", checkoutEl.innerText);
  fd.append("nights",   nightsEl.innerText);
  fd.append("adult",    adultInput.value);
  fd.append("child",    childInput.value);
  fd.append("pet",      petSelect.value);
  fd.append("note",     noteTextarea.value);

  try {
    const res = await fetch(GAS_URL, {
      method: "POST",
      body: fd
    }).then(r => r.json());

    Swal.fire({
  title: "é ç´„å®Œæˆï¼",
  html: `æ‚¨çš„è¨‚å–®ç·¨è™Ÿï¼š<b>${res.orderId}</b><br>æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è¨‚æˆ¿è³‡è¨Šâœ”`,
  icon: "success",
  confirmButtonText: "ç¢ºå®š",
  confirmButtonColor: "#1a73e8",
  width: "360px",
  customClass:{popup:"swal2-border-radius"}
});


  } catch (err) {
    console.error(err);
    alert("â— GAS é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ URL or éƒ¨ç½²ã€‚");
  }
};
</script>



</script>

</body>
</html>
