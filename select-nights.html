<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>選擇入住天數</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:"Noto Sans TC",sans-serif;
  background:#f7f7f7;
  margin:0;
}

/* === 主容器 ｜ 全站統一寬度 === */
.page-container{
  width:100%;
  max-width:660px;      /* ← 與表單頁統一 */
  margin:auto;
  padding:28px 18px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h2{
  font-size:26px;
  font-weight:800;
  text-align:center;
  margin-bottom:26px;
  width:100%;
}

/* === 每一晚選項 === */
.night-row{
  width:100%;               /* ⚠ 關鍵：不再偏左 */
  max-width:660px;
  background:#fff;
  border-radius:14px;
  padding:18px 22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:18px;
  margin-bottom:14px;
  cursor:pointer;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
  transition:.16s;
  box-sizing:border-box;
}

.night-row:hover{ transform:scale(1.02); }

.night-row.selected{
  background:#eaf4ff;
  border-left:5px solid #1a73e8;
}

.price{
  font-weight:700;
  color:#0b7d2b;
  font-size:18px;
}

/* === 下一步按鈕一致版 === */
.btn{
  width:100%;
  max-width:660px;
  background:#1a73e8;
  color:#fff;
  padding:18px;
  border-radius:12px;
  font-size:20px;
  font-weight:800;
  text-align:center;
  cursor:pointer;
  margin-top:30px;
  transition:.18s;
}
.btn:hover{opacity:.86;}
</style>
</head>

<body>

<div class="page-container">

  <h2 id="title">選擇入住天數</h2>

  <div id="nightContainer" style="width:100%;"></div>

  <div class="btn" id="nextBtn">下一步 ➜ 填寫資料</div>

</div><!-- container end -->

<script>
/* 參數 */
const params=new URLSearchParams(location.search);
const roomId=params.get("roomId");
const startDate=params.get("date");

let room=null,selectedNights=null;

/* 載入房型資料 */
loadRoomData();
async function loadRoomData(){
  const res=await fetch("data/rooms.json");
  const rooms=await res.json();
  room=rooms.find(r=>r.id===roomId);
  if(!room){ alert("房型不存在");return; }

  document.getElementById("title").innerText=`選擇入住天數（${room.title}）`;
  renderOptions();
}

/* 生成可選晚數 */
function renderOptions(){
  const box=document.getElementById("nightContainer");
  box.innerHTML="";

  for(let n=room.minNights;n<=room.maxNights;n++){
    const total=calcTotalPrice(n);

    const row=document.createElement("div");
    row.className="night-row";
    row.innerHTML=`
      <span>${n} 晚住宿</span>
      <span class="price">$${total.toLocaleString()}</span>
    `;

    row.onclick=()=>{
      selectedNights=n;
      document.querySelectorAll(".night-row")
        .forEach(e=>e.classList.remove("selected"));
      row.classList.add("selected");
    };

    box.appendChild(row);
  }
}

/* 計算金額 */
function calcTotalPrice(nights){
  let total=0;
  const base=new Date(startDate);

  for(let i=0;i<nights;i++){
    const d=new Date(base);
    d.setDate(base.getDate()+i);

    const k=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;

    if(room.specialPrice && room.specialPrice[k]){ total+=room.specialPrice[k];continue; }

    total+=([0,6].includes(d.getDay())?room.priceWeekend:room.priceWeekday);
  }
  return total;
}

/* 下一步 */
document.getElementById("nextBtn").onclick=()=>{
  if(!selectedNights) return alert("請先選擇天數");
  location.href=`form.html?roomId=${roomId}&date=${startDate}&nights=${selectedNights}`;
};
</script>

</body>
</html>
