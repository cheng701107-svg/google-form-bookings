<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>選擇入住天數</title>

<style>
  body {
    margin: 0;
    font-family: "Noto Sans TC", sans-serif;
    background: #f5f5f5;
  }

  .container {
    max-width: 700px;
    margin: 0 auto;
    padding: 16px;
  }

  .title {
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 12px;
  }
  
  .info-box {
    background: #fff;
    border-radius: 12px;
    padding: 16px;
    border: 1px solid #e6e6e6;
    margin-bottom: 16px;
  }

  .label {
    font-size: 15px;
    color: #777;
    margin-bottom: 6px;
  }

  .value {
    font-size: 17px;
    font-weight: 700;
  }

  .night-selector {
    background: #fff;
    border-radius: 12px;
    border: 1px solid #e6e6e6;
    padding: 16px;
    margin-bottom: 16px;
  }

  .night-btn {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 10px;
    border: 1px solid #e0e0e0;
    cursor: pointer;
    font-size: 16px;
  }

  .night-btn:hover {
    background: #eaf2fe;
    color: #1a73e8;
  }

  .night-active {
    background: #1a73e8 !important;
    color: #fff !important;
    border: none !important;
  }

  .next-btn {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    background: #1a73e8;
    color: #fff;
    font-size: 17px;
    border: none;
    cursor: pointer;
    margin-top: 20px;
  }

  .next-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
</style>

</head>

<body>
<div class="container">

  <div class="title">選擇入住天數</div>

  <div id="roomInfo" class="info-box"></div>

  <div class="night-selector" id="nightsList"></div>

  <button id="nextBtn" class="next-btn" disabled>下一步</button>

</div>

<script>
let roomId = new URLSearchParams(location.search).get("roomId");
let date = new URLSearchParams(location.search).get("date");

let selectedNights = null;
let roomData = null;

// 取得房型資料
async function loadRoom() {
  const res = await fetch("data/rooms.json");
  const rooms = await res.json();
  roomData = rooms.find(r => r.id === roomId);

  document.getElementById("roomInfo").innerHTML = `
    <div class="label">房型</div>
    <div class="value">${roomData.title}</div>
    <br>
    <div class="label">入住日期</div>
    <div class="value">${date}</div>
  `;

  renderNights();
}

// 產生可選晚數按鈕
function renderNights() {
  const box = document.getElementById("nightsList");
  box.innerHTML = "";

  for (let n = roomData.minNights; n <= roomData.maxNights; n++) {
    const btn = document.createElement("div");
    btn.className = "night-btn";
    btn.innerText = `${n} 晚（$${(roomData.price * n).toLocaleString()}）`;

    btn.onclick = () => selectNight(n, btn);

    box.appendChild(btn);
  }
}

function selectNight(n, btnElement) {
  selectedNights = n;

  // 全部移除 active
  [...document.getElementsByClassName("night-btn")].forEach(b =>
    b.classList.remove("night-active")
  );

  btnElement.classList.add("night-active");

  document.getElementById("nextBtn").disabled = false;
}

// 下一步 → 填資料
document.getElementById("nextBtn").onclick = () => {
  const checkoutDate = getCheckoutDate(date, selectedNights);

  window.location.href =
    `form.html?roomId=${roomId}&date=${date}&nights=${selectedNights}&checkout=${checkoutDate}`;
};

// 計算退房日期
function getCheckoutDate(start, nights) {
  const d = new Date(start);
  d.setDate(d.getDate() + nights);
  return d.toISOString().split("T")[0];
}

loadRoom();
</script>

</body>
</html>
